---
import Layout from "@/layouts/Layout.astro";
import Hero from "@/components/Hero.astro";
import About from "@/components/About.astro";
import PortfolioGrid from "@/components/PortfolioGrid.astro";
import { db } from "db";
import { store, portfolio } from "db/schema";
import { splitItems } from "@/lib/utils";

type StoreData = {
  [key: string]: string;
  siteTitleFirst: string;
  siteTitleSecond: string;
  siteDescriptionFirst: string;
  siteDescriptionSecond: string;
  aboutKey: string;
  about: string;
};

const storeData = await db.select().from(store);

const storeDataMap: StoreData = storeData.reduce((acc, cur) => {
  acc[cur.key as string] = cur.value as string;
  return acc;
}, {} as StoreData);

type GridData = {
  [key: string]: string | number | Date;
  media: string;
  title: string;
  slug: string;
}[][];

const grid = await db.select().from(portfolio);
const gridData: GridData = splitItems(grid) as GridData;
---

<Layout title={storeDataMap.siteTitleFirst + " " + storeDataMap.siteTitleSecond}>
  <Hero data={storeDataMap} />
  <PortfolioGrid data={gridData} />
  <About data={storeDataMap} />
</Layout>
<script defer is:inline src="https://flackr.github.io/scroll-timeline/dist/scroll-timeline.js"></script>
